<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Funzioni Search</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
    }

    /* Layout */
    #sidebar {
      width: 280px;
      background: #f5f5f5;
      border-right: 1px solid #ddd;
      padding: 20px;
      overflow-y: auto;
    }

    #content {
      flex-grow: 1;
      padding: 20px;
      overflow-y: auto;
    }

    /* Filtri */
    h3 {
      margin-bottom: 8px;
      margin-top: 25px;
    }

    .filter-option {
      margin-bottom: 5px;
    }

    /* Barra ricerca */
    #search {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    /* Risultati */
    .result-card {
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      background: white;
      box-shadow: 0px 1px 2px rgba(0,0,0,0.1);
    }

    .result-card h2 {
      margin: 0 0 10px 0;
      font-size: 20px;
    }

    .label-chip {
      display: inline-block;
      background: #e0e0e0;
      padding: 3px 8px;
      margin: 2px;
      border-radius: 6px;
      font-size: 12px;
    }
  </style>
</head>

<body>

  <!-- SIDEBAR FILTRI -->
  <div id="sidebar">
    <input id="search" placeholder="Cerca per nome o descrizioneâ€¦" />
    <div id="filters"></div>
  </div>

  <!-- COLONNA RISULTATI -->
  <div id="content">
    <div id="results"></div>
  </div>

  <script type="module">
    import { loadData, filterByText, getAllGroupedLabels, filterByLabel } from "./searchLibrary.js";

    let allData = [];
    let activeFilters = {};

    async function init() {
      allData = await loadData("./data.json");

      // genera filtri dinamici
      const groups = getAllGroupedLabels(allData);
      const fdiv = document.getElementById("filters");

      for (const key in groups) {
        const title = document.createElement("h3");
        title.textContent = key;
        fdiv.appendChild(title);

        groups[key].forEach(value => {
          const container = document.createElement("div");
          container.className = "filter-option";

          const rb = document.createElement("input");
          rb.type = "radio";
          rb.name = key;
          rb.value = value;

          rb.onchange = () => {
            activeFilters[key] = value;
            updateResults();
          };

          container.appendChild(rb);
          container.appendChild(document.createTextNode(" " + value));
          fdiv.appendChild(container);
        });
      }

      updateResults();
    }

    function updateResults() {
      const text = document.getElementById("search").value;

      let results = filterByText(allData, text);
      results = filterByLabel(results, activeFilters);

      const rdiv = document.getElementById("results");
      rdiv.innerHTML = results.map(r => `
        <div class="result-card">
          <h2>${r.metadata.name}</h2>
          <p>${r.metadata.description}</p>

          <div>
            ${r.metadata.labels
              .map(l => `<span class="label-chip">${l}</span>`)
              .join("")}
          </div>
        </div>
      `).join("");

      if (results.length === 0) {
        rdiv.innerHTML = "<p>Nessun risultato trovato.</p>";
      }
    }

    document.getElementById("search").oninput = updateResults;

    init();
  </script>

</body>
</html>
