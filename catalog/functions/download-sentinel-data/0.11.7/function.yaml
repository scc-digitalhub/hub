metadata:
  name: download-sentinel-data
  description: Function for Sentinel image download and preprocessing
  labels:
    - 'license:apache-2.0'
    - 'domain:geo'
    - 'application:pa'
    - 'platform:0.14'
    - 'aspect:data-engineering'
    - 'type:job'
    - 'phase:data-preparation'
    - 'framework:container-function'
kind: python
spec:
  template:
    args:
      - main.py
      - >-
        {"satelliteParams":{"satelliteType": "Sentinel2","processingLevel":
        "S2MSI2A","bandmath": ["NDWI"]},"startDate":"2018-10-27","endDate":
        "2018-11-17","geometry": "POLYGON ((11.123570406000056
        45.89602853500003, 11.123570406000056 46.35080675000006,
        11.833650907000049 46.35080675000006, 11.833650907000049
        45.89602853500003, 11.123570406000056 45.89602853500003))","cloudCover":
        "[0,20]","area_sampling": "True","artifact_name":
        "sentinel2_post_flood_val_di_fassa_oct_2018","preprocess_data_only":
        "false"}
    image: 'ghcr.io/tn-aixpa/sentinel-tools:0.11.7'
    volumes:
      - name: volume-flood
        spec:
          size: 100Gi
        volume_type: persistent_volume_claim
        mount_path: /app/files
    envs:
      - name: TMPDIR
        value: /app/files
    resources:
      cpu: '6'
      mem: 32Gi
    fs_group: 8877
    secrets:
      - CDSETOOL_ESA_USER
      - CDSETOOL_ESA_PASSWORD
    command: python
