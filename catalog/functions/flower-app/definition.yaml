
kind: flower-app
metadata:
  name: Flower App (flower-app)
  version: 1.0.0
  description: This function implements a Flower client application that connects to a Flower server, fetches data partitions, and sends results back to the server. It includes a sample implementation of the client-side logic for handling data partitions and communicating with the server.
  labels:
    - "license:apache-2.0"
    - "platform:0.14"
    - "type:service"
    # - "framework:flower"
name: flower-app
python_version: PYTHON3_10
spec:
  fab_source:
    clientapp: app
    serverapp: app
    clientbase64: IiIicGFuZGFzX2V4YW1wbGU6IEEgRmxvd2VyIC8gUGFuZGFzIGFwcC4iIiIKCmltcG9ydCB3YXJuaW5ncwoKaW1wb3J0IG51bXB5IGFzIG5wCmZyb20gZmx3cl9kYXRhc2V0cyBpbXBvcnQgRmVkZXJhdGVkRGF0YXNldApmcm9tIGZsd3JfZGF0YXNldHMucGFydGl0aW9uZXIgaW1wb3J0IElpZFBhcnRpdGlvbmVyCgpmcm9tIGZsd3IuY2xpZW50IGltcG9ydCBDbGllbnRBcHAKZnJvbSBmbHdyLmNvbW1vbiBpbXBvcnQgQ29udGV4dCwgTWVzc2FnZSwgTWV0cmljUmVjb3JkLCBSZWNvcmREaWN0CgpmZHMgPSBOb25lICAjIENhY2hlIEZlZGVyYXRlZERhdGFzZXQKCndhcm5pbmdzLmZpbHRlcndhcm5pbmdzKCJpZ25vcmUiLCBjYXRlZ29yeT1Vc2VyV2FybmluZykKCgpkZWYgZ2V0X2NsaWVudGFwcF9kYXRhc2V0KHBhcnRpdGlvbl9pZDogaW50LCBudW1fcGFydGl0aW9uczogaW50KToKICAgICMgT25seSBpbml0aWFsaXplIGBGZWRlcmF0ZWREYXRhc2V0YCBvbmNlCiAgICBnbG9iYWwgZmRzCiAgICBpZiBmZHMgaXMgTm9uZToKICAgICAgICBwYXJ0aXRpb25lciA9IElpZFBhcnRpdGlvbmVyKG51bV9wYXJ0aXRpb25zPW51bV9wYXJ0aXRpb25zKQogICAgICAgIGZkcyA9IEZlZGVyYXRlZERhdGFzZXQoCiAgICAgICAgICAgIGRhdGFzZXQ9InNjaWtpdC1sZWFybi9pcmlzIiwKICAgICAgICAgICAgcGFydGl0aW9uZXJzPXsidHJhaW4iOiBwYXJ0aXRpb25lcn0sCiAgICAgICAgKQoKICAgIGRhdGFzZXQgPSBmZHMubG9hZF9wYXJ0aXRpb24ocGFydGl0aW9uX2lkLCAidHJhaW4iKS53aXRoX2Zvcm1hdCgicGFuZGFzIilbOl0KICAgICMgVXNlIGp1c3QgdGhlIHNwZWNpZmllZCBjb2x1bW5zCiAgICByZXR1cm4gZGF0YXNldFtbIlNlcGFsTGVuZ3RoQ20iLCAiU2VwYWxXaWR0aENtIl1dCgoKIyBGbG93ZXIgQ2xpZW50QXBwCmFwcCA9IENsaWVudEFwcCgpCgoKQGFwcC5xdWVyeSgpCmRlZiBxdWVyeShtc2c6IE1lc3NhZ2UsIGNvbnRleHQ6IENvbnRleHQpOgogICAgIiIiQ29uc3RydWN0IGhpc3RvZ3JhbSBvZiBsb2NhbCBkYXRhc2V0IGFuZCByZXBvcnQgdG8gYFNlcnZlckFwcGAuIiIiCgogICAgIyBSZWFkIHRoZSBub2RlX2NvbmZpZyB0byBmZXRjaCBkYXRhIHBhcnRpdGlvbiBhc3NvY2lhdGVkIHRvIHRoaXMgbm9kZQogICAgcGFydGl0aW9uX2lkID0gY29udGV4dC5ub2RlX2NvbmZpZ1sicGFydGl0aW9uLWlkIl0KICAgIG51bV9wYXJ0aXRpb25zID0gY29udGV4dC5ub2RlX2NvbmZpZ1sibnVtLXBhcnRpdGlvbnMiXQoKICAgIGRhdGFzZXQgPSBnZXRfY2xpZW50YXBwX2RhdGFzZXQocGFydGl0aW9uX2lkLCBudW1fcGFydGl0aW9ucykKCiAgICBtZXRyaWNzID0ge30KICAgICMgQ29tcHV0ZSBzb21lIHN0YXRpc3RpY3MgZm9yIGVhY2ggY29sdW1uIGluIHRoZSBkYXRhZnJhbWUKICAgIGZvciBmZWF0dXJlX25hbWUgaW4gZGF0YXNldC5jb2x1bW5zOgogICAgICAgICMgQ29tcHV0ZSBoaXN0b2dyYW0KICAgICAgICBmcmVxcywgXyA9IG5wLmhpc3RvZ3JhbShkYXRhc2V0W2ZlYXR1cmVfbmFtZV0sIGJpbnM9bnAubGluc3BhY2UoMi4wLCAxMC4wLCAxMCkpCiAgICAgICAgbWV0cmljc1tmZWF0dXJlX25hbWVdID0gZnJlcXMudG9saXN0KCkKCiAgICAgICAgIyBDb21wdXRlIHdlaWdodGVkIGF2ZXJhZ2UKICAgICAgICBtZXRyaWNzW2Yie2ZlYXR1cmVfbmFtZX1fYXZnIl0gPSBkYXRhc2V0W2ZlYXR1cmVfbmFtZV0ubWVhbigpICogbGVuKGRhdGFzZXQpCiAgICAgICAgbWV0cmljc1tmIntmZWF0dXJlX25hbWV9X2NvdW50Il0gPSBsZW4oZGF0YXNldCkKCiAgICByZXBseV9jb250ZW50ID0gUmVjb3JkRGljdCh7InF1ZXJ5X3Jlc3VsdHMiOiBNZXRyaWNSZWNvcmQobWV0cmljcyl9KQoKICAgIHJldHVybiBNZXNzYWdlKHJlcGx5X2NvbnRlbnQsIHJlcGx5X3RvPW1zZyk=
    serverbase64: IiIicGFuZGFzX2V4YW1wbGU6IEEgRmxvd2VyIC8gUGFuZGFzIGFwcC4iIiIKCmltcG9ydCByYW5kb20KaW1wb3J0IHRpbWUKZnJvbSBjb2xsZWN0aW9ucy5hYmMgaW1wb3J0IEl0ZXJhYmxlCmZyb20gbG9nZ2luZyBpbXBvcnQgSU5GTwoKaW1wb3J0IG51bXB5IGFzIG5wCgpmcm9tIGZsd3IuY29tbW9uIGltcG9ydCBDb250ZXh0LCBNZXNzYWdlLCBNZXNzYWdlVHlwZSwgUmVjb3JkRGljdApmcm9tIGZsd3IuY29tbW9uLmxvZ2dlciBpbXBvcnQgbG9nCmZyb20gZmx3ci5zZXJ2ZXIgaW1wb3J0IEdyaWQsIFNlcnZlckFwcAoKYXBwID0gU2VydmVyQXBwKCkKCgpAYXBwLm1haW4oKQpkZWYgbWFpbihncmlkOiBHcmlkLCBjb250ZXh0OiBDb250ZXh0KSAtPiBOb25lOgogICAgIiIiVGhpcyBgU2VydmVyQXBwYCBjb25zdHJ1Y3QgYSBoaXN0b2dyYW0gZnJvbSBwYXJ0aWFsLWhpc3RvZ3JhbXMgcmVwb3J0ZWQgYnkgdGhlCiAgICBgQ2xpZW50QXBwYHMuIiIiCgogICAgbnVtX3JvdW5kcyA9IGNvbnRleHQucnVuX2NvbmZpZ1sibnVtLXNlcnZlci1yb3VuZHMiXQogICAgbWluX25vZGVzID0gMgogICAgZnJhY3Rpb25fc2FtcGxlID0gY29udGV4dC5ydW5fY29uZmlnWyJmcmFjdGlvbi1zYW1wbGUiXQoKICAgIGZvciBzZXJ2ZXJfcm91bmQgaW4gcmFuZ2UobnVtX3JvdW5kcyk6CiAgICAgICAgbG9nKElORk8sICIiKSAgIyBBZGQgbmV3bGluZSBmb3IgbG9nIHJlYWRhYmlsaXR5CiAgICAgICAgbG9nKElORk8sICJTdGFydGluZyByb3VuZCAlcy8lcyIsIHNlcnZlcl9yb3VuZCArIDEsIG51bV9yb3VuZHMpCgogICAgICAgICMgTG9vcCBhbmQgd2FpdCB1bnRpbCBlbm91Z2ggbm9kZXMgYXJlIGF2YWlsYWJsZS4KICAgICAgICBhbGxfbm9kZV9pZHM6IGxpc3RbaW50XSA9IFtdCiAgICAgICAgd2hpbGUgbGVuKGFsbF9ub2RlX2lkcykgPCBtaW5fbm9kZXM6CiAgICAgICAgICAgIGFsbF9ub2RlX2lkcyA9IGxpc3QoZ3JpZC5nZXRfbm9kZV9pZHMoKSkKICAgICAgICAgICAgaWYgbGVuKGFsbF9ub2RlX2lkcykgPj0gbWluX25vZGVzOgogICAgICAgICAgICAgICAgIyBTYW1wbGUgbm9kZXMKICAgICAgICAgICAgICAgIG51bV90b19zYW1wbGUgPSBpbnQobGVuKGFsbF9ub2RlX2lkcykgKiBmcmFjdGlvbl9zYW1wbGUpCiAgICAgICAgICAgICAgICBub2RlX2lkcyA9IHJhbmRvbS5zYW1wbGUoYWxsX25vZGVfaWRzLCBudW1fdG9fc2FtcGxlKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgbG9nKElORk8sICJXYWl0aW5nIGZvciBub2RlcyB0byBjb25uZWN0Li4uIikKICAgICAgICAgICAgdGltZS5zbGVlcCgyKQoKICAgICAgICBsb2coSU5GTywgIlNhbXBsZWQgJXMgbm9kZXMgKG91dCBvZiAlcykiLCBsZW4obm9kZV9pZHMpLCBsZW4oYWxsX25vZGVfaWRzKSkKCiAgICAgICAgIyBDcmVhdGUgbWVzc2FnZXMKICAgICAgICByZWNvcmRkaWN0ID0gUmVjb3JkRGljdCgpCiAgICAgICAgbWVzc2FnZXMgPSBbXQogICAgICAgIGZvciBub2RlX2lkIGluIG5vZGVfaWRzOiAgIyBvbmUgbWVzc2FnZSBmb3IgZWFjaCBub2RlCiAgICAgICAgICAgIG1lc3NhZ2UgPSBNZXNzYWdlKAogICAgICAgICAgICAgICAgY29udGVudD1yZWNvcmRkaWN0LAogICAgICAgICAgICAgICAgbWVzc2FnZV90eXBlPU1lc3NhZ2VUeXBlLlFVRVJZLCAgIyB0YXJnZXQgYHF1ZXJ5YCBtZXRob2QgaW4gQ2xpZW50QXBwCiAgICAgICAgICAgICAgICBkc3Rfbm9kZV9pZD1ub2RlX2lkLAogICAgICAgICAgICAgICAgZ3JvdXBfaWQ9c3RyKHNlcnZlcl9yb3VuZCksCiAgICAgICAgICAgICkKICAgICAgICAgICAgbWVzc2FnZXMuYXBwZW5kKG1lc3NhZ2UpCgogICAgICAgICMgU2VuZCBtZXNzYWdlcyBhbmQgd2FpdCBmb3IgYWxsIHJlc3VsdHMKICAgICAgICByZXBsaWVzID0gZ3JpZC5zZW5kX2FuZF9yZWNlaXZlKG1lc3NhZ2VzKQogICAgICAgIGxvZyhJTkZPLCAiUmVjZWl2ZWQgJXMvJXMgcmVzdWx0cyIsIGxlbihyZXBsaWVzKSwgbGVuKG1lc3NhZ2VzKSkKCiAgICAgICAgIyBBZ2dyZWdhdGUgcGFydGlhbCBoaXN0b2dyYW1zCiAgICAgICAgYWdncmVnYXRlZF9oaXN0ID0gYWdncmVnYXRlX3BhcnRpYWxfaGlzdG9ncmFtcyhyZXBsaWVzKQoKICAgICAgICAjIERpc3BsYXkgYWdncmVnYXRlZCBoaXN0b2dyYW0KICAgICAgICBsb2coSU5GTywgIkFnZ3JlZ2F0ZWQgaGlzdG9ncmFtOiAlcyIsIGFnZ3JlZ2F0ZWRfaGlzdCkKCgpkZWYgYWdncmVnYXRlX3BhcnRpYWxfaGlzdG9ncmFtcyhtZXNzYWdlczogSXRlcmFibGVbTWVzc2FnZV0pOgogICAgIiIiQWdncmVnYXRlIHBhcnRpYWwgaGlzdG9ncmFtcy4iIiIKCiAgICBhZ2dyZWdhdGVkX2hpc3QgPSB7fQogICAgdG90YWxfY291bnQgPSAwCiAgICBmb3IgcmVwIGluIG1lc3NhZ2VzOgogICAgICAgIGlmIHJlcC5oYXNfZXJyb3IoKToKICAgICAgICAgICAgY29udGludWUKICAgICAgICBxdWVyeV9yZXN1bHRzID0gcmVwLmNvbnRlbnRbInF1ZXJ5X3Jlc3VsdHMiXQogICAgICAgICMgU3VtIG1ldHJpY3MKICAgICAgICBmb3IgaywgdiBpbiBxdWVyeV9yZXN1bHRzLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIGsgaW4gWyJTZXBhbExlbmd0aENtIiwgIlNlcGFsV2lkdGhDbSJdOgogICAgICAgICAgICAgICAgaWYgayBpbiBhZ2dyZWdhdGVkX2hpc3Q6CiAgICAgICAgICAgICAgICAgICAgYWdncmVnYXRlZF9oaXN0W2tdICs9IG5wLmFycmF5KHYpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGFnZ3JlZ2F0ZWRfaGlzdFtrXSA9IG5wLmFycmF5KHYpCiAgICAgICAgICAgIGlmICJfY291bnQiIGluIGs6CiAgICAgICAgICAgICAgICB0b3RhbF9jb3VudCArPSB2CgogICAgIyBWZXJpZnkgYWdncmVnYXRlZCBoaXN0b2dyYW0gYWRkcyB1cCB0byB0b3RhbCByZXBvcnRlZCBjb3VudAogICAgYXNzZXJ0IHRvdGFsX2NvdW50ID09IHN1bShbc3VtKHYpIGZvciB2IGluIGFnZ3JlZ2F0ZWRfaGlzdC52YWx1ZXMoKV0pCiAgICByZXR1cm4gYWdncmVnYXRlZF9oaXN0
---
kind: flower-app+train:run
spec:
  parameters:
    num-server-rounds: 3
    fraction-sample: 1